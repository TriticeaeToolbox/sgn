
<%args>
$dataset_id 
$dataset_name => ''
$dataset_description => ''
$dataset_contents => ''

</%args>

<& /page/page_title.mas, title => "Dataset $dataset_name" &>
<& /util/import_javascript.mas, entries => ['dataset_scatterplot'], classes => [ 'jqueryui.js', 'jquery.js', 'd3.d3v4Min', 'jstree.dist.jstree', "thickbox", "CXGN.Page.FormattingHelpers" ] &>
<& /util/import_javascript.mas, entries => ['dataset'] &>
<& /util/import_css.mas, paths => ['wizard.css'] &>

<style>
  // .slider {
  //   -webkit-appearance: none;
  //   width: 100%;
  //   height: 20px;
  //   background: #d3d3d3;
  //   outline: none;
  //   opacity: 0.8;
  //   border-radius: 5px;
  //   -webkit-transition: .2s;
  //   transition: opacity .2s;
  // }

  // .slider:hover {
  //   opacity: 1;
  // }

  // .slider::-webkit-slider-thumb {
  //   -webkit-appearance: none;
  //   appearance: none;
  //   width: 25px;
  //   height: 25px;
  //   background: #04AA6D;
  //   cursor: pointer;
  // }

  // .slider::-moz-range-thumb {
  //   width: 25px;
  //   height: 25px;
  //   background: darkslategrey;
  //   cursor: pointer;
  // }

    .top-row {
        # display: flex;
        # justify-content: center;
        margin-top: 20px;    
    }

    input[type="range"] { 
        margin: auto;
        -webkit-appearance: none;
        position: relative;
        overflow: hidden;
        height: 40px;
        width: 200px;
        cursor: pointer;
        border-radius: 0; /* iOS */
    }

    ::-webkit-slider-runnable-track {
        background: #f7756c;
    }

/*
 * 1. Set to 0 width and remove border for a slider without a thumb
 * 2. Shadow is negative the full width of the input and has a spread 
 *    of the width of the input.
 */
    ::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 20px; /* 1 */
        height: 40px;
        background: #fff;
        box-shadow: -200px 0 0 200px #00ba38; /* 2 */
        border: 2px solid #999; /* 1 */
    }

    ::-moz-range-track {
        height: 40px;
        background: #f7756c;
    }

    ::-moz-range-thumb {
        background: #fff;
        height: 40px;
        width: 20px;
        border: 3px solid #999;
        border-radius: 0 !important;
        box-shadow: -200px 0 0 200px #00ba38;
        box-sizing: border-box;
    }

    ::-ms-fill-lower { 
        background: #00ba38;
    }

    ::-ms-fill-upper { 
        background: #f7756c;
    }

    ::-ms-thumb { 
        background: #fff;
        border: 2px solid #999;
        height: 40px;
        width: 20px;
        box-sizing: border-box;
    }

    ::-ms-ticks-after { 
        display: none; 
    }

    ::-ms-ticks-before { 
        display: none; 
    }

    ::-ms-track { 
        background: #ddd;
        color: transparent;
        height: 40px;
        border: none;
    }

    ::-ms-tooltip { 
        display: none;
    }

    #pagefooter {
        min-height: 150px !important;
    }

    #trait_selection {
        font-size: 15px;
    }

    # #trait_selections {
    #   float: left;
    #   max-width: 400px;
    #   height: 100px;
    #   font-size: 15px;
    # }

    # #store_outliers {
    #   float: right;
    #   padding: 5px;
    # }

    #dataset_slider {
        margin: 0 auto;
        padding: 10px;
        width: 200px;
    }

    #trait_graph {
        width: 65%;
        font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;    
    }

    table, th, td {
        padding: 15px;
    }

    .sd-line-top {
        stroke-dasharray: 5,5;
    }

    .sd-line-bottom {
        stroke-dasharray: 5,5;
    }

    .mean-line {
        stroke-dasharray: 5,5;
    }

    .btn-dataset {
        margin-left: 4px;
    } 



</style>


<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Dataset Details</title>
</head>

<%perl>
 my $wizard_link = '<a href=\'/breeders/search?dataset_id=' . $dataset_id . '\'>' . $dataset_name . '</a>';
</%perl>

<body>
    <div id="wizard" class="row">
        <div class="wizard-datasets">
            <table id="dataset_results"; border="1">
                    <tr><td>Name<td><% $dataset_name %>
                    <tr><td>Description<td><% $dataset_description %>
                    <tr><td>Contents<td><% $dataset_contents %>
%                   if ($c->user()) {
                        <tr><td>Edit<td>
                        <span class="input-group-btn">
                        <span><button style="width:9em;margin-left:4px;" class="btn btn-sm btn-primary" id="wizard-dataset-public">Make Public</button></span>
                        <span><button style="width:9em;margin-left:4px;" class="btn btn-sm btn-primary" id="wizard-dataset-private">Make Private</button></span>
                        <span><button style="width:5em;margin-left:4px;" class="btn btn-sm btn-danger" id="wizard-dataset-delete">Delete</button></span>
                        </span>
%                   }
                    <tr><td>Select Dataset in Wizard<td><% $wizard_link %>
            </table>
        </div>
    </div>

    <div class="row">
        <div class="top-row col-md-12">

            <div id="trait_selections" class="col-md-6">
            <label for="trait_selection">Select a Trait: </label>
            <select id="trait_selection" name="trait_selection">
                <option value="default">Select Trait</option>
            </select>
            </div>

            <div id="dataset_slider" class="col-md-3">
            <input type="range" min="1" max="12" value="6" class="slider form-range" id="outliersRange">
            </div>


        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div id="trait_graph"></div>
        </div>
        <div class="col-md-12">
            <div class="input-group-btn col-md-11 col-md-offset-1">
                <span>
                    <button class="btn btn-sm btn-success btn-dataset" id="store_outliers">Add selection to outliers</button>
                </span>
                <span>
                        <button class="btn btn-sm btn-danger btn-dataset" id="reset_outliers">Reset all outliers</button>
                </span>
                <span>
                        <button class="btn btn-sm btn-danger btn-dataset" id="reset_trait">Reset outliers for current trait</button>
                </span>
                <!--
                <span>
                    <button class="btn btn-sm btn-primary btn-dataset" id="retrieve_outliers">Retrieve Outliers</button>
                </span>
                -->
                <!--
                <span>
                    <button class="btn btn-sm btn-primary btn-dataset" id="show_outliers">Show Outliers</button>
                </span>
                -->
                <span>
                    <button class="btn btn-sm btn-primary btn-dataset" id="outliers_phenotype_download">Download Phenotype Table without Outliers  </button>
                </span>
            </div>
        </div>
    </div>
    
    <script>

    jQuery(document).ready( function() {
        
        console.log('dataset id', '<% $dataset_id %>');
        var DataSet = window.jsMod['dataset_scatterplot'].init(<% $dataset_id %>);
        DataSet.render();

        jQuery('#info_table').click(function() {
            $.ajax({
                url: '/ajax/dataset/by_user/<% $dataset_id %>',
                success: function(response) {
                    alert(response.options);
                },
                error: function(response) {
                    alert("An error occurred");
                }  
            });
        })        

        jQuery('#outliers_phenotype_download').click(function() {            

            var speed = 'MaterializedViewTable';
            var format = '.csv';
            var level = 'all';
            var timestamp = 0;
            // var entry_numbers = 0;
            // var outliers = 0;
            // var names = "";
            // var min = "";
            // var max = "";

            var url = document.location.origin+
                `/breeders/download_action?trait_ids_list=${DataSet.traitsIds}`+
                `&format=${format}`+            
                `&phenotype_datalevel=${level}`+
                `&timestamp_included=${timestamp}`+
                `&dataset_id=<% $dataset_id %>`
            
            // console.log(url);
            window.open(url,'_blank');
        })
    });

    </script>
</body>