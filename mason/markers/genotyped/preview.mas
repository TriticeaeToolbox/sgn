<%doc>
=head1 NAME

Variant Detail Page

=head1 DESCRIPTION

A detail page for variants / markers stored in the genotype protocol props, 
and summarized in the materialized_markerview materialized view

=head1 ARGUMENTS

=over 5

=item variant_name

The name of the variant, as used in the variant_name column of the materialized_markerview table

=item markers

An arrayref containing a hash for each marker for the variant.  The marker hash has the following 
keys: chrom, species_name, reference_genome_name, pos, alt, ref

=item related_variants 

A hashref containing the variants and the markers related to one or more of the markers in the current variant

=back
</%doc>

<%args>
    $variant_name => undef
    $markers => undef
</%args>

<%init>
    if ( !$variant_name ) {
        print "<p><strong>ERROR: </strong>Missing variant name!</p>";
    }
    if ( !$markers ) {
        print "<p><strong>ERROR: </strong>Missing variant markers!</p>";
    }

    # Set variant properties
    my $species = ${$markers}[0]->{'species_name'};
    my $ref = ${$markers}[0]->{'reference_genome_name'};
    my $chrom = ${$markers}[0]->{'chrom'};
    my $pos = ${$markers}[0]->{'pos'};

    # Set title
    my $title = $species . " Markers";
    my $subtitle = "Chromosome " . $chrom . " @ " . $pos;

    # Set parameters for jbrowse
    my $jbrowse_location = $chrom . ':' . $pos;

    # Set query parameters for the sequence metadata table
    my %smd_params = (
        "sequence_metadata_results" => {
            "feature" => $chrom,
            "species" => $species,
            "reference_genome" => $ref,
            "start" => $pos,
            "end" => $pos
        }
    );
</%init>



<& /page/page_title.mas, title=> "$title Preview" &>
<& /page/page_title.mas, title=> $subtitle &>

<br /><br />


<!-- VARIANT DETAILS TABLE -->
<&| /page/info_section.mas, title=>'Genotype locations', collapsible=>1, collapsed=>0 &>
    <& /markers/genotyped/genotype_locations.mas, markers => $markers &>
</&>

<!-- FLANKING SEQUENCE -->
<&| /page/info_section.mas, title=>'Flanking Sequence', collapsible=>1, collapsed=>0 &>
    <& /markers/genotyped/flanking_sequence.mas, markers => $markers &>
</&>

<!-- RELATED VARIANTS LINKS -->
<&| /page/info_section.mas, title=>'Related Markers', collapsible=>1, collapsed=>0 &>
    <& /markers/genotyped/related_markers.mas, variant_name => $variant_name &>
</&>

<div class='alert' style='color: #31708f; background-color: #d9edf7; border-color: #bce8f1;'>
  <p style='font-size: 120%; border-bottom: 1px solid rgb(49, 112, 143, 0.2); margin-bottom: 15px'><strong>View More Information</strong></p>
  <p>To view all of the information about this variant, <strong>create an account</strong> and <strong>log in</strong>.</p>
  <br />
  <a href="/user/new?goto_url=/variant/<% $variant_name %>/details" class="btn btn-info btn-large btn-home">
    <span class="glyphicon glyphicon-plus"></span>&nbsp;Create an Account
  </a>
  <a href="/user/login?goto_url=/variant/<% $variant_name %>/details" class="btn btn-primary btn-large btn-home">
    <span class="glyphicon glyphicon-user"></span>&nbsp;Login
  </a>
</div>

<style>
    .btn-info, .btn-primary {
      color: #fff !important;
    }
    .btn-info:hover {
      background-color: #31b0d5 !important;
    }
    .btn-primary:hover {
      background-color: #286090 !important;
    }
</style>
